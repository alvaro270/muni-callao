<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ComedorDigital - Gesti√≥n de Beneficiarios</title>
    <link rel="stylesheet" href="../css/style.css"> <!-- Se linkea el CSS general -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#0B42A0",
              secondary: "#10B099",
            },
          },
        },
      };
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header (sin cambios) -->
    <header class="bg-white shadow-md border-b border-gray-200">
        <div class="container mx-auto px-4">
            <div class="hidden md:flex items-center justify-between h-20 py-4">
                <div class="flex items-center flex-shrink-0"><img src="../assets/img/logo.png" alt="Logo Municipalidad del callao" class="h-12 lg:h-16 w-auto" /></div>
                <div class="flex items-center justify-center flex-grow"><h1 class="text-xl lg:text-2xl font-bold text-gray-800">ComedorDigital</h1></div>
                <div class="flex items-center flex-shrink-0"><img src="../assets/img/PROGRESAMOS_TODOS_2.png" alt="Callao Progresamos todos" class="h-12 lg:h-16 w-auto" /></div>
            </div>
            <div class="md:hidden flex items-center justify-between h-16 py-2">
                <div class="flex items-center"><img src="../assets/img/logo.png" alt="Logo Municipalidad del callao" class="h-10 w-auto" /></div>
                <div class="flex-grow text-center"><h1 class="text-lg font-bold text-gray-800">ComedorDigital</h1></div>
                <div class="flex items-center"><img src="../assets/img/PROGRESAMOS_TODOS_2.png" alt="Callao Progresamos todos" class="h-10 w-auto" /></div>
            </div>
        </div>
    </header>

    <!-- TAREA 3: NAVEGACI√ìN CORREGIDA -->
    <nav class="bg-primary shadow-sm">
        <div class="container mx-auto px-4">
            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center justify-center space-x-1 lg:space-x-2 py-3">
                <a href="../index.html" class="text-white hover:bg-blue-700 px-3 lg:px-4 py-2 rounded-lg font-medium text-sm lg:text-base flex items-center space-x-2 transition-colors"><span>üè†</span> <span>Dashboard</span></a>
                <!-- Corregido: 'Comedores' ahora tiene el estilo inactivo -->
                <a href="../comedor/comedor.html" class="text-white hover:bg-blue-700 px-3 lg:px-4 py-2 rounded-lg font-medium text-sm lg:text-base flex items-center space-x-2 transition-colors"><span>üè¢</span> <span>Comedores</span></a>
                <!-- Corregido: 'Beneficiarios' ahora tiene el estilo activo -->
                <a href="beneficiario.html" class="bg-white text-primary px-3 lg:px-4 py-2 rounded-lg font-medium text-sm lg:text-base flex items-center space-x-2 shadow-sm"><span>üë•</span> <span>Beneficiarios</span></a>
                <a href="../entregas/entregas.html" class="text-white hover:bg-blue-700 px-3 lg:px-4 py-2 rounded-lg font-medium text-sm lg:text-base flex items-center space-x-2 transition-colors"><span>üçΩÔ∏è</span> <span>Entregas</span></a>
            </div>

            <!-- Mobile Navigation -->
            <div class="md:hidden">
                <div class="flex items-center justify-between py-3">
                    <!-- El bot√≥n principal ya estaba correcto -->
                    <span class="bg-white text-primary px-4 py-2 rounded-lg font-medium text-sm flex items-center space-x-2 shadow-sm"><span>üë•</span> <span>Beneficiarios</span></span>
                    <button id="mobile-menu-btn" class="text-white hover:bg-blue-700 px-3 py-2 rounded-lg transition-colors" onclick="mostrarMenuMovil()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                </div>
                <!-- TAREA 4: MEN√ö M√ìVIL ASEGURADO QUE EST√â CERRADO POR DEFECTO -->
                <div id="mobile-menu" class="mobile-menu">
                    <div class="pb-3 space-y-2">
                        <a href="../index.html" class="w-full block text-white hover:bg-blue-700 px-4 py-3 rounded-lg font-medium text-sm flex items-center space-x-2 transition-colors"><span>üè†</span> <span>Dashboard</span></a>
                        <a href="../comedor/comedor.html" class="w-full block text-white hover:bg-blue-700 px-4 py-3 rounded-lg font-medium text-sm flex items-center space-x-2 transition-colors"><span>üè¢</span> <span>Comedores</span></a>
                        <a href="../entregas/entregas.html" class="w-full block text-white hover:bg-blue-700 px-4 py-3 rounded-lg font-medium text-sm flex items-center space-x-2 transition-colors"><span>üçΩÔ∏è</span> <span>Entregas</span></a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <!-- TAREA 2: TARJETA DE DATOS CENTRADA -->
    <main class="container mx-auto px-4 py-6 flex justify-center">
        <div class="w-full max-w-3xl bg-white shadow-lg rounded-xl p-6 space-y-6 border-t-4 border-primary">
            <h2 class="text-2xl font-bold text-gray-800 border-b pb-4 flex items-center space-x-2"><span>üë§</span><span>Datos del Beneficiario</span></h2>
            <!-- Formulario (sin cambios) -->
            <div class="flex flex-col md:flex-row items-start gap-2">
                <label class="w-full md:w-40 font-medium text-gray-700">Nombre Completo: <span class="text-red-500">*</span></label>
                <input type="text" placeholder="[Ingrese nombre completo]" class="flex-1 w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-sm" />
            </div>
            <div class="flex flex-col md:flex-row items-start gap-2">
                <label class="w-full md:w-40 font-medium text-gray-700">DNI: <span class="text-red-500">*</span></label>
                <input type="text" placeholder="[12345678]" maxlength="8" class="flex-1 w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-sm" />
            </div>
            <div class="flex flex-col md:flex-row items-start gap-2">
                <label class="w-full md:w-40 font-medium text-gray-700">Comedor: <span class="text-red-500">*</span></label>
                <select id="comedorSelect" class="flex-1 w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-sm text-gray-600">
                    <option disabled selected>Seleccionar Comedor...</option>
                </select>
            </div>
            <div class="flex flex-col md:flex-row items-start gap-2">
                <label class="w-full md:w-40 font-medium text-gray-700">Estado:</label>
                <input type="text" value="Activo" readonly class="flex-1 w-full border border-gray-200 bg-gray-100 rounded-lg px-4 py-2 text-green-600 font-medium text-sm" />
            </div>
            <div class="flex justify-end space-x-4 pt-4 border-t mt-6">
                <button id="cancelarBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-5 py-2 rounded-lg text-sm font-medium">Cancelar</button>
                <button id="guardarBtn" class="bg-primary hover:bg-blue-800 text-white px-5 py-2 rounded-lg text-sm font-medium">Guardar</button>
            </div>
        </div>
    </main>

     <!-- La secci√≥n de la tabla de beneficiarios se movi√≥ aqu√≠, fuera del contenedor centrado -->
    <section class="container mx-auto px-4 py-6 mt-2">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center space-x-2"><span>üìã</span><span>Beneficiarios Registrados</span></h3>
        <div class="overflow-x-auto bg-white rounded-lg shadow border border-gray-200">
            <table class="min-w-full text-sm text-gray-700 divide-y divide-gray-200" id="tablaBeneficiarios">
                <thead class="bg-primary text-white text-left text-sm">
                    <tr>
                        <th class="px-4 py-3">Nombre</th>
                        <th class="px-4 py-3">DNI</th>
                        <th class="px-4 py-3">Comedor</th>
                        <th class="px-4 py-3">Estado</th>
                        <th class="px-4 py-3">Fecha</th>
                        <th class="px-4 py-3 text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tbodyBeneficiarios" class="divide-y divide-gray-100 bg-white"></tbody>
            </table>
        </div>
    </section>

    <!-- Footer (sin cambios) -->
    <footer class="bg-gray-800 text-white py-6 md:py-8 mt-12">
      <!-- ... contenido del footer ... -->
    </footer>

    <!-- El script de esta p√°gina est√° embebido, sin cambios en la l√≥gica JS -->
    <script>
      // El JS proporcionado en el archivo original se mantiene aqu√≠
      let indiceEdicion = null; 

      document.addEventListener("DOMContentLoaded", () => {
        const comedorSelect = document.getElementById("comedorSelect");
        const guardarBtn = document.getElementById("guardarBtn");
        const cancelarBtn = document.getElementById("cancelarBtn");
        const nombreInput = document.querySelector(
          "input[placeholder='[Ingrese nombre completo]']"
        );
        const dniInput = document.querySelector(
          "input[placeholder='[12345678]']"
        );
        const estadoInput = document.querySelector("input[value='Activo']");

        function cargarComedores() {
          try {
            const comedoresStorage = localStorage.getItem("comedores");
            if (comedoresStorage) {
              const comedores = JSON.parse(comedoresStorage);
              comedorSelect.innerHTML = "<option disabled selected>Seleccionar Comedor...</option>";
              comedores
                .filter((comedor) => comedor.estado === "Activo")
                .forEach((comedor) => {
                  const option = document.createElement("option");
                  option.value = comedor.id;
                  option.textContent = `${comedor.nombre} - ${comedor.direccion}`;
                  option.dataset.nombre = comedor.nombre;
                  comedorSelect.appendChild(option);
                });
            }
          } catch (error) {
            console.error("Error al cargar comedores:", error);
          }
        }

        function limpiarFormulario() {
          nombreInput.value = "";
          dniInput.value = "";
          comedorSelect.selectedIndex = 0;
          estadoInput.value = "Activo";
          indiceEdicion = null;
        }

        function validarDNI(dni) {
          return /^\d{8}$/.test(dni);
        }

        dniInput.addEventListener("input", (e) => {
          e.target.value = e.target.value.replace(/[^0-9]/g, "");
        });

        guardarBtn.addEventListener("click", () => {
          const nombre = nombreInput.value.trim();
          const dni = dniInput.value.trim();
          const comedorId = comedorSelect.value;
          const comedorNombre = comedorSelect.options[comedorSelect.selectedIndex]?.dataset.nombre;
          const estado = estadoInput.value;

          if (!nombre) { alert("Por favor ingresa el nombre completo."); nombreInput.focus(); return; }
          if (!validarDNI(dni)) { alert("Por favor ingresa un DNI v√°lido de 8 d√≠gitos."); dniInput.focus(); return; }
          if (!comedorId || comedorId === "Seleccionar Comedor...") { alert("Por favor selecciona un comedor."); comedorSelect.focus(); return; }

          try {
            const nuevoBeneficiario = {
              nombre: nombre,
              dni: dni,
              comedor: { id: parseInt(comedorId), nombre: comedorNombre },
              estado: estado,
              fechaRegistro: new Date().toISOString(),
            };
            const beneficiarios = JSON.parse(localStorage.getItem("beneficiarios")) || [];

            if (indiceEdicion !== null) {
              beneficiarios[indiceEdicion] = nuevoBeneficiario;
              indiceEdicion = null;
            } else {
              const yaExiste = beneficiarios.some((b) => b.dni === dni);
              if (yaExiste) { alert("Ya existe un beneficiario registrado con ese DNI."); dniInput.focus(); return; }
              beneficiarios.push(nuevoBeneficiario);
            }
            localStorage.setItem("beneficiarios", JSON.stringify(beneficiarios));
            alert("‚úÖ Beneficiario guardado correctamente.");
            limpiarFormulario();
            mostrarBeneficiarios();
          } catch (error) {
            console.error("Error al guardar beneficiario:", error);
            alert("Error al guardar el beneficiario. Intenta nuevamente.");
          }
        });

        cancelarBtn.addEventListener("click", () => {
          if (nombreInput.value || dniInput.value || comedorSelect.selectedIndex > 0) {
            if (confirm("¬øEst√°s seguro de que deseas cancelar? Se perder√°n los datos ingresados.")) {
              limpiarFormulario();
            }
          }
        });

        cargarComedores();
        mostrarBeneficiarios();

        window.addEventListener("storage", (e) => {
          if (e.key === "comedores") {
            cargarComedores();
          }
        });
      });

      function mostrarMenuMovil() {
          const menu = document.getElementById('mobile-menu');
          menu.classList.toggle('open');
      }

      function mostrarBeneficiarios() {
        const tbody = document.getElementById("tbodyBeneficiarios");
        tbody.innerHTML = "";
        const beneficiarios = JSON.parse(localStorage.getItem("beneficiarios")) || [];
        beneficiarios.forEach((b, index) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="px-4 py-2">${b.nombre}</td>
            <td class="px-4 py-2">${b.dni}</td>
            <td class="px-4 py-2">${b.comedor?.nombre || "-"}</td>
            <td class="px-4 py-2">${b.estado}</td>
            <td class="px-4 py-2">${new Date(b.fechaRegistro).toLocaleDateString()}</td>
            <td class="px-4 py-2 text-center space-x-2">
              <button onclick="editarBeneficiario(${index})" class="text-blue-600 hover:text-blue-800 font-medium">‚úèÔ∏è</button>
              <button onclick="eliminarBeneficiario(${index})" class="text-red-600 hover:text-red-800 font-medium">üóëÔ∏è</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function eliminarBeneficiario(index) {
        if (confirm("¬øSeguro que deseas eliminar este beneficiario?")) {
          const beneficiarios = JSON.parse(localStorage.getItem("beneficiarios")) || [];
          beneficiarios.splice(index, 1);
          localStorage.setItem("beneficiarios", JSON.stringify(beneficiarios));
          mostrarBeneficiarios();
        }
      }

      function editarBeneficiario(index) {
        const beneficiarios = JSON.parse(localStorage.getItem("beneficiarios")) || [];
        const b = beneficiarios[index];
        document.querySelector("input[placeholder='[Ingrese nombre completo]']").value = b.nombre;
        document.querySelector("input[placeholder='[12345678]']").value = b.dni;
        document.getElementById("comedorSelect").value = b.comedor?.id;
        document.querySelector("input[value='Activo']").value = b.estado;
        indiceEdicion = index;
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    </script>
</body>
</html>
